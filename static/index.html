<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Website Audit Pro v4.0 - Multi-Page SEO Analysis + Core Web Vitals + Broken Links</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="Free website audit: multi-page crawl, keyword research, tech detection, Core Web Vitals, and broken link detection.">
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-B5E74SGTP9"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-B5E74SGTP9');
  </script>
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white min-h-screen">
  <header class="border-b border-gray-700/50 backdrop-blur-sm sticky top-0 z-50">
    <div class="container mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
          <span class="text-2xl">üîç</span>
          <span class="font-bold text-xl bg-gradient-to-r from-cyan-400 to-green-400 bg-clip-text text-transparent">
            Website Audit Pro v4.0
          </span>
        </div>
        <div id="savedBadge" class="hidden px-3 py-1 bg-green-500/20 text-green-400 rounded-full text-sm">
          ‚úÖ Saved
        </div>
      </div>
    </div>
  </header>

  <section class="container mx-auto px-4 py-12 text-center">
    <div class="mb-2 inline-flex items-center gap-2 px-3 py-1 bg-purple-500/20 text-purple-400 rounded-full text-sm">
      <span>üöÄ</span> Multi-Page Crawl Now Available
    </div>
    <h1 class="text-4xl md:text-6xl font-bold mb-6">
      Free <span class="bg-gradient-to-r from-cyan-400 to-green-400 bg-clip-text text-transparent">Website Audit</span>
    </h1>
    <p class="text-xl text-gray-400 mb-4">Crawl up to 20 pages ‚Ä¢ 25+ checks ‚Ä¢ Keyword research ‚Ä¢ Tech detection ‚Ä¢ Core Web Vitals ‚Ä¢ Broken Links</p>
    
    <div class="max-w-xl mx-auto bg-gray-800/50 backdrop-blur rounded-2xl p-6 border border-gray-700/50 shadow-2xl">
      <input type="url" id="url" placeholder="example.com OR https://example.com" 
             class="w-full p-4 bg-gray-900/50 rounded-xl border border-gray-600 text-white placeholder-gray-500 focus:border-cyan-400 focus:outline-none mb-4">
      <div class="flex gap-4 mb-4">
        <input type="number" id="maxPages" value="10" min="1" max="20" 
               class="w-24 p-4 bg-gray-900/50 rounded-xl border border-gray-600 text-white focus:border-green-400 focus:outline-none"
               title="Number of pages to crawl">
        <button onclick="runAudit()" id="auditBtn"
                class="flex-1 py-4 bg-gradient-to-r from-cyan-500 to-green-500 rounded-xl font-bold text-gray-900">
          üöÄ Run Full Audit
        </button>
      </div>
    </div>
  </section>

  <!-- Feature Tabs -->
  <section class="container mx-auto px-4 py-8">
    <div class="flex flex-wrap justify-center gap-4">
      <button onclick="switchTab('audit')" id="tab-audit" class="tab-btn px-4 py-2 bg-cyan-500/20 text-cyan-400 rounded-lg border border-cyan-500/30">
        üîç Full Audit
      </button>
      <button onclick="switchTab('core-web-vitals')" id="tab-core-web-vitals" class="tab-btn px-4 py-2 bg-gray-700/30 text-gray-400 rounded-lg border border-gray-600/30">
        üìä Core Web Vitals
      </button>
      <button onclick="switchTab('broken-links')" id="tab-broken-links" class="tab-btn px-4 py-2 bg-gray-700/30 text-gray-400 rounded-lg border border-gray-600/30">
        üîó Broken Links
      </button>
    </div>
  </section>

  <!-- Core Web Vitals Section -->
  <section id="cwv-section" class="hidden container mx-auto px-4 py-12">
    <div class="max-w-4xl mx-auto bg-gray-800/50 backdrop-blur rounded-2xl p-6 border border-gray-700/50">
      <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
        <span class="text-3xl">üìä</span> Core Web Vitals Analysis
      </h2>
      <p class="text-gray-400 mb-4">Check your site's LCP, CLS, and INP scores using Google PageSpeed Insights.</p>
      
      <div class="flex gap-4 mb-6">
        <input type="url" id="cwvUrl" placeholder="example.com OR https://example.com" 
               class="flex-1 p-4 bg-gray-900/50 rounded-xl border border-gray-600 text-white placeholder-gray-500 focus:border-purple-400 focus:outline-none">
        <select id="cwvStrategy" class="p-4 bg-gray-900/50 rounded-xl border border-gray-600 text-white focus:border-purple-400 focus:outline-none">
          <option value="mobile">üì± Mobile</option>
          <option value="desktop">üíª Desktop</option>
        </select>
        <button onclick="runCoreWebVitals()" id="cwvBtn"
                class="px-6 py-4 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl font-bold text-white">
          üìä Analyze
        </button>
      </div>

      <!-- CWV Results -->
      <div id="cwv-results" class="hidden">
        <div class="grid md:grid-cols-4 gap-4 mb-6">
          <div id="cwv-score-card" class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700 text-center">
            <div class="text-5xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent" id="cwv-overall">-</div>
            <div class="text-gray-400 mt-2">Performance Score</div>
          </div>
          <div id="cwv-lcp-card" class="bg-gray-800/50 rounded-xl p-4 border border-gray-700 text-center">
            <div class="text-3xl font-bold text-cyan-400" id="cwv-lcp">-</div>
            <div class="text-sm text-gray-400">LCP (Load)</div>
            <div class="text-xs" id="cwv-lcp-rating"></div>
          </div>
          <div id="cwv-cls-card" class="bg-gray-800/50 rounded-xl p-4 border border-gray-700 text-center">
            <div class="text-3xl font-bold text-yellow-400" id="cwv-cls">-</div>
            <div class="text-sm text-gray-400">CLS (Stability)</div>
            <div class="text-xs" id="cwv-cls-rating"></div>
          </div>
          <div id="cwv-inp-card" class="bg-gray-800/50 rounded-xl p-4 border border-gray-700 text-center">
            <div class="text-3xl font-bold text-green-400" id="cwv-inp">-</div>
            <div class="text-sm text-gray-400">INP (Responsive)</div>
            <div class="text-xs" id="cwv-inp-rating"></div>
          </div>
        </div>

        <div id="cwv-recommendations" class="bg-purple-900/20 rounded-xl p-4 border border-purple-500/30">
          <h3 class="font-bold mb-3">üí° Recommendations</h3>
          <div id="cwv-recs-list" class="space-y-3"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Broken Links Section -->
  <section id="bl-section" class="hidden container mx-auto px-4 py-12">
    <div class="max-w-4xl mx-auto bg-gray-800/50 backdrop-blur rounded-2xl p-6 border border-gray-700/50">
      <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
        <span class="text-3xl">üîó</span> Broken Link Detection
      </h2>
      <p class="text-gray-400 mb-4">Find broken links, redirects, and crawl errors on your website.</p>
      
      <div class="flex gap-4 mb-6">
        <input type="url" id="blUrl" placeholder="example.com OR https://example.com" 
               class="flex-1 p-4 bg-gray-900/50 rounded-xl border border-gray-600 text-white placeholder-gray-500 focus:border-orange-400 focus:outline-none">
        <button onclick="runBrokenLinks()" id="blBtn"
                class="px-6 py-4 bg-gradient-to-r from-orange-500 to-red-500 rounded-xl font-bold text-white">
          üîó Scan Links
        </button>
      </div>

      <!-- Broken Links Results -->
      <div id="bl-results" class="hidden">
        <div class="grid md:grid-cols-4 gap-4 mb-6">
          <div class="bg-green-500/10 rounded-lg p-4 border border-green-500/30 text-center">
            <div class="text-3xl font-bold text-green-400" id="bl-ok">0</div>
            <div class="text-sm text-gray-400">Working</div>
          </div>
          <div class="bg-yellow-500/10 rounded-lg p-4 border border-yellow-500/30 text-center">
            <div class="text-3xl font-bold text-yellow-400" id="bl-redirects">0</div>
            <div class="text-sm text-gray-400">Redirects</div>
          </div>
          <div class="bg-red-500/10 rounded-lg p-4 border border-red-500/30 text-center">
            <div class="text-3xl font-bold text-red-400" id="bl-broken">0</div>
            <div class="text-sm text-gray-400">Broken</div>
          </div>
          <div class="bg-gray-500/10 rounded-lg p-4 border border-gray-500/30 text-center">
            <div class="text-3xl font-bold text-gray-400" id="bl-total">0</div>
            <div class="text-sm text-gray-400">Total Scanned</div>
          </div>
        </div>

        <div id="bl-broken-list" class="hidden bg-red-900/20 rounded-xl p-4 border border-red-500/30 mb-4">
          <h3 class="font-bold text-red-400 mb-3">‚ùå Broken Links Found</h3>
          <div id="bl-broken-items" class="space-y-2 text-sm"></div>
        </div>

        <div id="bl-redirect-list" class="hidden bg-yellow-900/20 rounded-xl p-4 border border-yellow-500/30 mb-4">
          <h3 class="font-bold text-yellow-400 mb-3">‚ö†Ô∏è Redirect Chains</h3>
          <div id="bl-redirect-items" class="space-y-2 text-sm"></div>
        </div>

        <div id="bl-recs" class="bg-gray-800/50 rounded-xl p-4 border border-gray-700">
          <h3 class="font-bold mb-2">üí° Tips</h3>
          <div id="bl-recs-list" class="text-sm text-gray-400"></div>
        </div>
      </div>
    </div>
  </section>

  <section id="audit-section" class="container mx-auto px-4 py-12">
  <section id="results" class="hidden container mx-auto px-4 py-12">
    <div class="max-w-7xl mx-auto">
      <!-- Score Card -->
      <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-8 border border-gray-700 mb-6">
        <div class="grid md:grid-cols-6 gap-6 text-center">
          <div>
            <div class="text-6xl font-bold bg-gradient-to-r from-cyan-400 to-green-400 bg-clip-text text-transparent" id="score">-</div>
            <div class="text-gray-400 mt-2">Overall Score</div>
            <div class="text-3xl font-bold text-gray-300" id="grade">-</div>
          </div>
          <div>
            <div class="text-4xl font-bold text-cyan-400" id="perfScore">-</div>
            <div class="text-gray-400 mt-2">Performance</div>
          </div>
          <div>
            <div class="text-4xl font-bold text-purple-400" id="industryScore">-</div>
            <div class="text-gray-400 mt-2">vs Industry</div>
          </div>
          <div>
            <div class="text-4xl font-bold text-orange-400" id="keywordCount">-</div>
            <div class="text-gray-400 mt-2">Keywords</div>
          </div>
          <div>
            <div class="text-4xl font-bold text-blue-400" id="pagesCrawled">-</div>
            <div class="text-gray-400 mt-2">Pages Crawled</div>
          </div>
          <div>
            <div class="text-4xl font-bold text-pink-400" id="techCount">-</div>
            <div class="text-gray-400 mt-2">Tech Found</div>
          </div>
        </div>
      </div>

      <!-- Multi-Page Analysis -->
      <div id="pageAnalysis" class="hidden bg-gradient-to-br from-indigo-900/30 to-blue-900/30 rounded-2xl p-6 border border-indigo-500/30 mb-6">
        <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
          <span>üìÑ</span> Multi-Page Crawl Analysis
        </h3>
        <div class="grid md:grid-cols-4 gap-4 mb-4">
          <div class="bg-indigo-500/10 rounded-lg p-4 border border-indigo-500/30 text-center">
            <div class="text-3xl font-bold text-indigo-400" id="totalPages">0</div>
            <div class="text-sm text-gray-400">Total Pages</div>
          </div>
          <div class="bg-green-500/10 rounded-lg p-4 border border-green-500/30 text-center">
            <div class="text-3xl font-bold text-green-400" id="successfulPages">0</div>
            <div class="text-sm text-gray-400">Successful</div>
          </div>
          <div class="bg-red-500/10 rounded-lg p-4 border border-red-500/30 text-center">
            <div class="text-3xl font-bold text-red-400" id="errorPages">0</div>
            <div class="text-sm text-gray-400">Errors</div>
          </div>
          <div class="bg-yellow-500/10 rounded-lg p-4 border border-yellow-500/30 text-center">
            <div class="text-3xl font-bold text-yellow-400" id="totalSize">0</div>
            <div class="text-sm text-gray-400">Total KB</div>
          </div>
        </div>
        <div id="crawledUrls" class="text-sm text-gray-400"></div>
      </div>

      <!-- Tech Stack Section -->
      <div id="techSection" class="hidden bg-gradient-to-br from-indigo-900/30 to-purple-900/30 rounded-2xl p-6 border border-indigo-500/30 mb-6">
        <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
          <span>‚ö°</span> Technology Stack Detected
        </h3>
        <div class="grid md:grid-cols-4 gap-4" id="techStack"></div>
      </div>

      <!-- GSC Insights -->
      <div id="gscSection" class="hidden bg-gradient-to-br from-blue-900/30 to-cyan-900/30 rounded-2xl p-6 border border-blue-500/30 mb-6">
        <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
          <span>üìà</span> Search Insights
        </h3>
        <div class="grid md:grid-cols-3 gap-4" id="gscQueries"></div>
      </div>

      <!-- Keywords Section -->
      <div id="keywordsSection" class="hidden bg-gradient-to-br from-purple-900/30 to-cyan-900/30 rounded-2xl p-6 border border-purple-500/30 mb-6">
        <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
          <span>üîë</span> Keyword Research & Content Ideas
        </h3>
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <h4 class="text-sm font-semibold text-purple-400 mb-2">TOP KEYWORDS</h4>
            <div id="primaryKeywords" class="flex flex-wrap gap-2"></div>
          </div>
          <div>
            <h4 class="text-sm font-semibold text-cyan-400 mb-2">CONTENT IDEAS</h4>
            <div id="contentPillars" class="space-y-2"></div>
          </div>
        </div>
        <div class="mt-4">
          <h4 class="text-sm font-semibold text-orange-400 mb-2">LONG-TAIL OPPORTUNITIES</h4>
          <div id="longTail" class="flex flex-wrap gap-2"></div>
        </div>
        <div class="mt-4">
          <h4 class="text-sm font-semibold text-green-400 mb-2">QUESTIONS FOR FAQ</h4>
          <div id="questions" class="flex flex-wrap gap-2"></div>
        </div>
      </div>

      <!-- Categories -->
      <div class="grid md:grid-cols-4 gap-4 mb-6" id="categories"></div>

      <!-- Detailed Checks -->
      <div class="bg-gray-800/30 rounded-xl p-6 border border-gray-700/30 mb-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold">üìä Detailed Analysis</h3>
          <button onclick="generatePDF()" id="pdfBtn"
                  class="px-4 py-2 bg-red-500/20 text-red-400 rounded-lg border border-red-500/30 hover:bg-red-500/30 transition">
            üìÑ Export PDF Report
          </button>
        </div>
        <div class="grid md:grid-cols-3 lg:grid-cols-4 gap-3" id="checks"></div>
      </div>

      <!-- White-Label Settings (Collapsible) -->
      <div class="bg-gray-800/30 rounded-xl p-6 border border-gray-700/30 mb-6">
        <button onclick="toggleWhiteLabel()" class="flex items-center gap-2 text-gray-400 hover:text-white transition">
          <span>üé®</span>
          <span>White-Label Settings</span>
          <span id="wl-toggle">‚ñº</span>
        </button>
        <div id="white-label-panel" class="hidden mt-4 pt-4 border-t border-gray-700">
          <p class="text-sm text-gray-400 mb-4">Customize the PDF report with your brand information.</p>
          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm text-gray-400 mb-2">Company/Agency Name</label>
              <input type="text" id="wlCompanyName" placeholder="My SEO Agency"
                     class="w-full p-3 bg-gray-900/50 rounded-lg border border-gray-600 text-white placeholder-gray-500 focus:border-cyan-400 focus:outline-none">
            </div>
            <div>
              <label class="block text-sm text-gray-400 mb-2">Primary Color</label>
              <input type="color" id="wlPrimaryColor" value="#2563eb"
                     class="w-full h-11 p-1 bg-gray-900/50 rounded-lg border border-gray-600">
            </div>
            <div>
              <label class="block text-sm text-gray-400 mb-2">Contact URL</label>
              <input type="url" id="wlContactUrl" placeholder="https://myagency.com"
                     class="w-full p-3 bg-gray-900/50 rounded-lg border border-gray-600 text-white placeholder-gray-500 focus:border-cyan-400 focus:outline-none">
            </div>
            <div>
              <label class="block text-sm text-gray-400 mb-2">Logo URL (optional)</label>
              <input type="url" id="wlLogoUrl" placeholder="https://myagency.com/logo.png"
                     class="w-full p-3 bg-gray-900/50 rounded-lg border border-gray-600 text-white placeholder-gray-500 focus:border-cyan-400 focus:outline-none">
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div id="loading" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center">
    <div class="text-center">
      <div class="animate-spin w-16 h-16 border-4 border-cyan-400 border-t-transparent rounded-full mx-auto mb-4"></div>
      <p class="text-xl">Running multi-page crawl...</p>
      <p class="text-sm text-gray-400" id="crawlProgress">Crawling pages...</p>
    </div>
  </div>

  <script>
    const COLORS = { security: 'border-red-500', performance: 'border-blue-500', seo: 'border-purple-500', technical: 'border-yellow-500', social: 'border-pink-500', ux: 'border-green-500', links: 'border-orange-500', branding: 'border-cyan-500' };
    const ICONS = { security: 'üîê', performance: '‚ö°', seo: 'üìù', technical: '‚öôÔ∏è', social: 'üì±', ux: 'üéØ', links: 'üîó', branding: 'üé®' };
    let currentTab = 'audit';

    function switchTab(tab) {
      currentTab = tab;
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('bg-cyan-500/20', 'text-cyan-400', 'border-cyan-500/30');
        btn.classList.add('bg-gray-700/30', 'text-gray-400', 'border-gray-600/30');
      });
      const activeBtn = document.getElementById('tab-' + tab);
      activeBtn.classList.remove('bg-gray-700/30', 'text-gray-400', 'border-gray-600/30');
      activeBtn.classList.add('bg-cyan-500/20', 'text-cyan-400', 'border-cyan-500/30');
      
      document.getElementById('audit-section')?.classList.add('hidden');
      document.getElementById('results')?.classList.add('hidden');
      document.getElementById('cwv-section')?.classList.add('hidden');
      document.getElementById('bl-section')?.classList.add('hidden');
      
      if (tab === 'audit') {
        document.getElementById('results')?.classList.remove('hidden');
      } else if (tab === 'core-web-vitals') {
        document.getElementById('cwv-section')?.classList.remove('hidden');
      } else if (tab === 'broken-links') {
        document.getElementById('bl-section')?.classList.remove('hidden');
      }
    }

    async function runAudit() {
      let url = document.getElementById('url').value.trim();
      const maxPages = document.getElementById('maxPages').value || 10;
      if (!url) return alert('Enter your website URL');
      if (!url.startsWith('http')) url = 'https://' + url;
      
      document.getElementById('loading').classList.remove('hidden');
      document.getElementById('results').classList.add('hidden');
      document.getElementById('savedBadge').classList.add('hidden');
      
      try {
        document.getElementById('crawlProgress').textContent = 'Crawling homepage...';
        const res = await fetch('https://local-audit-tool.vercel.app/api/audit', {
          method: 'POST', headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ url, pages: maxPages })
        });
        
        const data = await res.json();
        if (!res.ok || data.error) throw new Error(data.error || 'Failed');
        displayResults(data);
      } catch (e) {
        alert('Error: ' + e.message);
      } finally {
        document.getElementById('loading').classList.add('hidden');
      }
    }

    async function runCoreWebVitals() {
      let url = document.getElementById('cwvUrl').value.trim();
      const strategy = document.getElementById('cwvStrategy').value;
      if (!url) return alert('Enter your website URL');
      if (!url.startsWith('http')) url = 'https://' + url;
      
      const btn = document.getElementById('cwvBtn');
      btn.disabled = true;
      btn.textContent = '‚è≥ Analyzing...';
      
      try {
        const res = await fetch('https://local-audit-tool.vercel.app/api/check-core-web-vitals', {
          method: 'POST', headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ url, strategy })
        });
        
        const data = await res.json();
        if (!res.ok || data.error) throw new Error(data.error || 'Failed');
        displayCoreWebVitals(data);
      } catch (e) {
        alert('Error: ' + e.message);
      } finally {
        btn.disabled = false;
        btn.textContent = 'üìä Analyze';
      }
    }

    function displayCoreWebVitals(data) {
      document.getElementById('cwv-results').classList.remove('hidden');
      
      document.getElementById('cwv-overall').textContent = data.overallScore || 0;
      document.getElementById('cwv-lcp').textContent = (data.coreWebVitals?.lcp?.value || 0) + 'ms';
      document.getElementById('cwv-cls').textContent = (data.coreWebVitals?.cls?.value || 0).toFixed(3);
      document.getElementById('cwv-inp').textContent = (data.coreWebVitals?.inp?.value || 0) + 'ms';
      
      // Ratings
      const ratingColors = { good: 'text-green-400', 'needs-improvement': 'text-yellow-400', poor: 'text-red-400' };
      const lcpRating = data.coreWebVitals?.lcp?.rating || 'poor';
      const clsRating = data.coreWebVitals?.cls?.rating || 'poor';
      const inpRating = data.coreWebVitals?.inp?.rating || 'poor';
      
      document.getElementById('cwv-lcp-rating').textContent = lcpRating.toUpperCase().replace('-', ' ');
      document.getElementById('cwv-lcp-rating').className = 'text-xs ' + (ratingColors[lcpRating] || 'text-red-400');
      
      document.getElementById('cwv-cls-rating').textContent = clsRating.toUpperCase().replace('-', ' ');
      document.getElementById('cwv-cls-rating').className = 'text-xs ' + (ratingColors[clsRating] || 'text-red-400');
      
      document.getElementById('cwv-inp-rating').textContent = inpRating.toUpperCase().replace('-', ' ');
      document.getElementById('cwv-inp-rating').className = 'text-xs ' + (ratingColors[inpRating] || 'text-red-400');
      
      // Recommendations
      const recsList = document.getElementById('cwv-recs-list');
      recsList.innerHTML = '';
      (data.recommendations || []).forEach(rec => {
        recsList.innerHTML += `
          <div class="border-l-2 border-purple-500 pl-3">
            <div class="font-medium text-white">${rec.title}</div>
            <div class="text-xs text-gray-400 mb-1">${rec.metric} ‚Ä¢ ${rec.priority}</div>
            <ul class="text-xs text-gray-400 list-disc list-inside">
              ${(rec.actions || []).slice(0, 3).map(a => `<li>${a}</li>`).join('')}
            </ul>
          </div>
        `;
      });
    }

    async function runBrokenLinks() {
      let url = document.getElementById('blUrl').value.trim();
      if (!url) return alert('Enter your website URL');
      if (!url.startsWith('http')) url = 'https://' + url;
      
      const btn = document.getElementById('blBtn');
      btn.disabled = true;
      btn.textContent = '‚è≥ Scanning...';
      
      try {
        const res = await fetch('https://local-audit-tool.vercel.app/api/check-broken-links', {
          method: 'POST', headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ url, maxLinks: 50 })
        });
        
        const data = await res.json();
        if (!res.ok || data.error) throw new Error(data.error || 'Failed');
        displayBrokenLinks(data);
      } catch (e) {
        alert('Error: ' + e.message);
      } finally {
        btn.disabled = false;
        btn.textContent = 'üîó Scan Links';
      }
    }

    function displayBrokenLinks(data) {
      document.getElementById('bl-results').classList.remove('hidden');
      
      document.getElementById('bl-total').textContent = data.summary?.totalLinksChecked || 0;
      document.getElementById('bl-ok').textContent = data.summary?.ok || 0;
      document.getElementById('bl-redirects').textContent = data.summary?.redirects || 0;
      document.getElementById('bl-broken').textContent = data.summary?.broken || 0;
      
      // Broken links list
      const brokenList = document.getElementById('bl-broken-list');
      const brokenItems = document.getElementById('bl-broken-items');
      if ((data.brokenLinks || []).length > 0) {
        brokenList.classList.remove('hidden');
        brokenItems.innerHTML = data.brokenLinks.map(link => 
          `<div class="flex items-center gap-2 p-2 bg-red-500/10 rounded">
            <span class="text-red-400 font-mono text-xs break-all">${link.url.substring(0, 60)}${link.url.length > 60 ? '...' : ''}</span>
            <span class="text-xs text-gray-500">${link.statusCode}</span>
          </div>`
        ).join('');
      } else {
        brokenList.classList.add('hidden');
      }
      
      // Redirects list
      const redirectList = document.getElementById('bl-redirect-list');
      const redirectItems = document.getElementById('bl-redirect-items');
      if ((data.redirects || []).length > 0) {
        redirectList.classList.remove('hidden');
        redirectItems.innerHTML = data.redirects.slice(0, 5).map(link => 
          `<div class="flex items-center gap-2 p-2 bg-yellow-500/10 rounded">
            <span class="text-yellow-400 text-xs break-all">${link.url.substring(0, 50)}...</span>
            <span class="text-xs text-gray-500">‚Üí ${link.redirectUrl?.substring(0, 30)}...</span>
          </div>`
        ).join('');
      } else {
        redirectList.classList.add('hidden');
      }
      
      // Recommendations
      const recsList = document.getElementById('bl-recs-list');
      recsList.innerHTML = (data.recommendations || []).map(r => `<p>‚Ä¢ ${r}</p>`).join('');
    }

    function displayResults(data) {
      let url = document.getElementById('url').value.trim();
      const maxPages = document.getElementById('maxPages').value || 10;
      if (!url) return alert('Enter your website URL');
      if (!url.startsWith('http')) url = 'https://' + url;
      
      document.getElementById('loading').classList.remove('hidden');
      document.getElementById('results').classList.add('hidden');
      document.getElementById('savedBadge').classList.add('hidden');
      
      try {
        document.getElementById('crawlProgress').textContent = 'Crawling homepage...';
        const res = await fetch('https://local-audit-tool.vercel.app/api/audit', {
          method: 'POST', headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ url, pages: maxPages })
        });
        
        const data = await res.json();
        if (!res.ok || data.error) throw new Error(data.error || 'Failed');
        displayResults(data);
      } catch (e) {
        alert('Error: ' + e.message);
      } finally {
        document.getElementById('loading').classList.add('hidden');
      }
    }

    function displayResults(data) {
      if (!data || data.error) return;
      
      document.getElementById('results').classList.remove('hidden');
      if (data.saved) document.getElementById('savedBadge').classList.remove('hidden');
      
      // Scores
      document.getElementById('score').textContent = data.score ?? '-';
      document.getElementById('grade').textContent = data.grade ?? '-';
      document.getElementById('perfScore').textContent = data.performance?.score ?? '-';
      document.getElementById('industryScore').textContent = data.comparison?.industryAverage ?? '-';
      document.getElementById('keywordCount').textContent = (data.keywords?.primary?.length ?? 0);
      document.getElementById('pagesCrawled').textContent = (data.pages?.totalPages ?? 0);
      
      // Multi-Page Analysis
      const pageSection = document.getElementById('pageAnalysis');
      if (data.pages) {
        pageSection.classList.remove('hidden');
        document.getElementById('totalPages').textContent = data.pages.totalPages;
        document.getElementById('successfulPages').textContent = data.pages.successful;
        document.getElementById('errorPages').textContent = data.pages.errors;
        document.getElementById('totalSize').textContent = data.pages.totalSizeKB;
        
        const crawledEl = document.getElementById('crawledUrls');
        if (data.crawledUrls?.length > 1) {
          crawledEl.innerHTML = '<strong>Crawled:</strong> ' + data.crawledUrls.slice(0, 5).map(u => {
            try { return new URL(u).pathname; } catch { return u; }
          }).join(' ‚Üí ') + (data.crawledUrls.length > 5 ? ' ‚Üí ...' : '');
        }
      } else {
        pageSection.classList.add('hidden');
      }
      
      // Tech Stack
      const tech = data.techStack || {};
      const techTotal = (tech.cms?.length || 0) + (tech.frameworks?.length || 0) + (tech.analytics?.length || 0) + (tech.hosting?.length || 0);
      document.getElementById('techCount').textContent = techTotal;
      
      const techSection = document.getElementById('techSection');
      if (techTotal > 0) {
        techSection.classList.remove('hidden');
        document.getElementById('techStack').innerHTML = `
          <div class="bg-indigo-500/10 rounded-lg p-3 border border-indigo-500/30"><div class="text-xs text-indigo-400 mb-1">CMS</div><div class="text-sm">${(tech.cms || []).join(', ') || 'None'}</div></div>
          <div class="bg-purple-500/10 rounded-lg p-3 border border-purple-500/30"><div class="text-xs text-purple-400 mb-1">FRAMEWORKS</div><div class="text-sm">${(tech.frameworks || []).join(', ') || 'None'}</div></div>
          <div class="bg-pink-500/10 rounded-lg p-3 border border-pink-500/30"><div class="text-xs text-pink-400 mb-1">ANALYTICS</div><div class="text-sm">${(tech.analytics || []).join(', ') || 'None'}</div></div>
          <div class="bg-cyan-500/10 rounded-lg p-3 border border-cyan-500/30"><div class="text-xs text-cyan-400 mb-1">HOSTING</div><div class="text-sm">${(tech.hosting || []).join(', ') || 'None'}</div></div>
        `;
      } else {
        techSection.classList.add('hidden');
      }
      
      // GSC
      const gsc = data.gsc || {};
      const gscSection = document.getElementById('gscSection');
      if (gsc.mockData?.queries?.length > 0) {
        gscSection.classList.remove('hidden');
        document.getElementById('gscQueries').innerHTML = (gsc.mockData.queries || []).map(q => `
          <div class="bg-blue-500/10 rounded-lg p-3 border border-blue-500/30">
            <div class="font-medium text-sm">${q.query}</div>
            <div class="text-xs text-gray-400">${q.clicks} clicks ‚Ä¢ ${q.impressions} imp ‚Ä¢ ${q.ctr}</div>
          </div>
        `).join('');
      } else {
        gscSection.classList.add('hidden');
      }
      
      // Keywords
      const kw = data.keywords || {};
      const kwSection = document.getElementById('keywordsSection');
      if (kw.primary?.length > 0) {
        kwSection.classList.remove('hidden');
        document.getElementById('primaryKeywords').innerHTML = (kw.primary || []).slice(0, 10).map(k => 
          `<span class="px-3 py-1 bg-purple-500/20 text-purple-300 rounded-full text-sm">${k.word || ''} (${k.count || 0})</span>`
        ).join('');
        document.getElementById('contentPillars').innerHTML = (kw.contentPillars || []).slice(0, 4).map(p => 
          `<div class="p-2 bg-cyan-500/10 rounded border border-cyan-500/30 text-sm"><span class="text-xs text-cyan-400">${(p.type || '').toUpperCase()}</span><div class="font-medium">${p.title || ''}</div></div>`
        ).join('');
        document.getElementById('longTail').innerHTML = (kw.longTailOpportunities || []).slice(0, 10).map(k => 
          `<span class="px-2 py-1 bg-orange-500/10 text-orange-300 rounded text-xs">${k || ''}</span>`
        ).join('');
        document.getElementById('questions').innerHTML = (kw.questionsForFAQ || []).slice(0, 6).map(q => 
          `<span class="px-2 py-1 bg-green-500/10 text-green-300 rounded text-xs">${q || ''}</span>`
        ).join('');
      } else {
        kwSection.classList.add('hidden');
      }
      
      // Categories
      const catScores = {};
      for (const [cat, checks] of Object.entries(data.byCategory || {})) {
        const passed = (checks || []).filter(c => c.passed).length;
        catScores[cat] = { passed, total: (checks || []).length };
      }
      
      document.getElementById('categories').innerHTML = Object.entries(COLORS).map(([cat, color]) => {
        const s = catScores[cat] || { passed: 0, total: 0 };
        return `<div class="bg-gray-800/50 rounded-xl p-4 border ${color}">
          <div class="text-2xl mb-2">${ICONS[cat] || 'üìÅ'}</div>
          <div class="text-sm text-gray-400 capitalize">${cat}</div>
          <div class="text-xl font-bold">${s.total ? Math.round(s.passed/s.total*100) : 0}%</div>
          <div class="text-xs text-gray-500">${s.passed}/${s.total}</div>
        </div>`;
      }).join('');
      
      // Checks
      document.getElementById('checks').innerHTML = (data.checks || []).map(c => `
        <div class="flex items-center gap-2 p-2 rounded ${c.passed ? 'bg-green-500/10' : 'bg-red-500/10'}">
          <span class="${c.passed ? 'text-green-400' : 'text-red-400'}">${c.passed ? '‚úì' : '‚úó'}</span>
          <span class="text-sm">${c.issue || ''}</span>
        </div>
      `).join('');
      
      document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
    }

    // PDF Export Function
    async function generatePDF() {
      // Get current audit data from the last run
      if (!window.lastAuditData) {
        alert('Please run an audit first before generating a PDF report.');
        return;
      }

      const btn = document.getElementById('pdfBtn');
      btn.disabled = true;
      btn.textContent = '‚è≥ Generating PDF...';

      try {
        // Get white-label settings
        const whiteLabelSettings = {
          companyName: document.getElementById('wlCompanyName')?.value || 'Website Audit Report',
          primaryColor: document.getElementById('wlPrimaryColor')?.value || '#2563eb',
          contactUrl: document.getElementById('wlContactUrl')?.value || '',
          logoUrl: document.getElementById('wlLogoUrl')?.value || null
        };

        const response = await fetch('https://local-audit-tool.vercel.app/api/generate-pdf', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            auditData: window.lastAuditData,
            ...whiteLabelSettings
          })
        });

        if (!response.ok) {
          throw new Error('Failed to generate PDF');
        }

        // Download the PDF
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        
        // Generate filename
        const hostname = new URL(window.lastAuditData.url).hostname;
        const timestamp = new Date().toISOString().split('T')[0];
        a.download = `audit-report-${hostname}-${timestamp}.pdf`;
        
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);

      } catch (e) {
        alert('Error generating PDF: ' + e.message);
      } finally {
        btn.disabled = false;
        btn.textContent = 'üìÑ Export PDF Report';
      }
    }

    // White-Label Toggle
    function toggleWhiteLabel() {
      const panel = document.getElementById('white-label-panel');
      const toggle = document.getElementById('wl-toggle');
      
      if (panel.classList.contains('hidden')) {
        panel.classList.remove('hidden');
        toggle.textContent = '‚ñ≤';
      } else {
        panel.classList.add('hidden');
        toggle.textContent = '‚ñº';
      }
    }

    // Store last audit data for PDF export
    const originalDisplayResults = displayResults;
    displayResults = function(data) {
      window.lastAuditData = data;
      originalDisplayResults(data);
    };
  </script>
</body>
</html>
